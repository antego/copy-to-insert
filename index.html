<html>
<head>
    <title>
        A Simple HTML Document
    </title>
</head>
<body>
<input type="file" name="file" id="file">
<script>
    // Function to download data to a file
    function download(data, filename, type) {
        const file = new Blob([data], {type: type});
        if (window.navigator.msSaveOrOpenBlob) // IE10+
            window.navigator.msSaveOrOpenBlob(file, filename);
        else { // Others
            const a = document.createElement("a"),
                url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            setTimeout(function () {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 0);
        }
    }

    const copyRegex = new RegExp(/copy(.+)from/gi);
    let delimRegex = /\t/g;
    let nullRegex = /'\\N'/g;
    const nullOptionRegex = /null\s*'(\S*)'/i;

    function convertLines(originLines, targetLines) {
        let insideCopy = false;
        let lastCopyPos = 0;
        for (let lineNum = 0; lineNum < originLines.length; lineNum++) {
            const line = originLines[lineNum];
            if (line.match(copyRegex)) {
                const tableAndFields = copyRegex.exec(line)[1];
                targetLines.push("insert into" + tableAndFields + "values ");
                insideCopy = true;
                lastCopyPos = lineNum;
                if (line.match(nullOptionRegex)) {
                    nullRegex = new RegExp("'" + nullOptionRegex.exec(line)[1] + "'", "g")
                }
            } else if (line.startsWith("\\.")) {
                insideCopy = false;
                // not converting empty copy statements
                if (lastCopyPos === lineNum - 1) {
                    targetLines.pop();
                } else {
                    // remove trailing coma
                    const lastValues = targetLines.pop();
                    targetLines.push(lastValues.substr(0, lastValues.length - 1) + ";")
                }
            } else if (insideCopy === true) {
                let insertLine = "('" + line.replace(delimRegex, "', '") + "'),";
                insertLine = insertLine.replace(nullRegex, "NULL");
                targetLines.push(insertLine);
            } else {
                targetLines.push(line);
            }
        }
    }

    document.getElementById('file').onchange = function () {
        const file = this.files[0];
        const reader = new FileReader();
        reader.onload = function (progressEvent) {
            const originLines = this.result.split('\n');
            const targetLines = [];
            convertLines(originLines, targetLines);
            download(targetLines.join("\n"), 'myfilename.txt', 'text/plain')
        };
        reader.readAsText(file);
    };


</script>
</body>
</html>


